{"ast":null,"code":"// src/utils/SkyController.js\nimport * as THREE from 'three';\nimport { Sky } from 'three/examples/jsm/objects/Sky.js';\nexport default class SkyController {\n  constructor(scene, camera, renderer) {\n    this.scene = scene;\n    this.camera = camera;\n    this.renderer = renderer;\n    this.sun = new THREE.Vector3();\n\n    // 初始化天空\n    this.sky = new Sky();\n    this.sky.scale.setScalar(450000);\n    this.scene.add(this.sky);\n\n    // 初始化 uniforms\n    this.effectController = {\n      turbidity: 16,\n      rayleigh: 6,\n      mieCoefficient: 0.005,\n      mieDirectionalG: 0.8,\n      luminance: 1,\n      inclination: 0.49,\n      // 地平线上的太阳角度\n      azimuth: 0.45,\n      // 方位角\n      sun: !true // 如果是 true，禁用太阳效果\n    };\n    this.initSky();\n  }\n  initSky() {\n    this.updateSky();\n  }\n  updateSky() {\n    const uniforms = this.sky.material.uniforms;\n    uniforms['turbidity'].value = this.effectController.turbidity;\n    uniforms['rayleigh'].value = this.effectController.rayleigh;\n    uniforms['mieCoefficient'].value = this.effectController.mieCoefficient;\n    uniforms['mieDirectionalG'].value = this.effectController.mieDirectionalG;\n    //uniforms['luminance'].value = this.effectController.luminance;\n\n    // 更新太阳位置\n    const theta = Math.PI * (this.effectController.inclination - 0.5);\n    const phi = 2 * Math.PI * (this.effectController.azimuth - 0.5);\n    this.sun.x = Math.cos(phi);\n    this.sun.y = Math.sin(phi) * Math.sin(theta);\n    this.sun.z = Math.sin(phi) * Math.cos(theta);\n    uniforms['sunPosition'].value.copy(this.sun);\n    this.renderer.render(this.scene, this.camera);\n  }\n\n  // 允许外部通过此方法更新参数\n  setParameters(params) {\n    this.effectController = {\n      ...this.effectController,\n      ...params\n    };\n    this.updateSky();\n  }\n  animate() {\n    requestAnimationFrame(this.animate.bind(this));\n    this.updateSky();\n  }\n}","map":{"version":3,"names":["THREE","Sky","SkyController","constructor","scene","camera","renderer","sun","Vector3","sky","scale","setScalar","add","effectController","turbidity","rayleigh","mieCoefficient","mieDirectionalG","luminance","inclination","azimuth","initSky","updateSky","uniforms","material","value","theta","Math","PI","phi","x","cos","y","sin","z","copy","render","setParameters","params","animate","requestAnimationFrame","bind"],"sources":["E:/three.js/three.js-demo/three-city/city/src/three/mesh/sky.js"],"sourcesContent":["// src/utils/SkyController.js\r\nimport * as THREE from 'three';\r\nimport { Sky } from 'three/examples/jsm/objects/Sky.js';\r\n\r\nexport default class SkyController {\r\n  constructor(scene, camera, renderer) {\r\n    this.scene = scene;\r\n    this.camera = camera;\r\n    this.renderer = renderer;\r\n    this.sun = new THREE.Vector3();\r\n    \r\n    // 初始化天空\r\n    this.sky = new Sky();\r\n    this.sky.scale.setScalar(450000);\r\n    this.scene.add(this.sky);\r\n    \r\n    // 初始化 uniforms\r\n    this.effectController = {\r\n      turbidity: 16,\r\n      rayleigh: 6,\r\n      mieCoefficient: 0.005,\r\n      mieDirectionalG: 0.8,\r\n      luminance: 1,\r\n      inclination: 0.49,  // 地平线上的太阳角度\r\n      azimuth: 0.45,     // 方位角\r\n      sun: !true          // 如果是 true，禁用太阳效果\r\n    };\r\n    \r\n    this.initSky();\r\n  }\r\n\r\n  initSky() {\r\n    this.updateSky();\r\n  }\r\n\r\n  updateSky() {\r\n    const uniforms = this.sky.material.uniforms;\r\n    uniforms['turbidity'].value = this.effectController.turbidity;\r\n    uniforms['rayleigh'].value = this.effectController.rayleigh;\r\n    uniforms['mieCoefficient'].value = this.effectController.mieCoefficient;\r\n    uniforms['mieDirectionalG'].value = this.effectController.mieDirectionalG;\r\n    //uniforms['luminance'].value = this.effectController.luminance;\r\n\r\n    // 更新太阳位置\r\n    const theta = Math.PI * (this.effectController.inclination - 0.5);\r\n    const phi = 2 * Math.PI * (this.effectController.azimuth - 0.5);\r\n\r\n    this.sun.x = Math.cos(phi);\r\n    this.sun.y = Math.sin(phi) * Math.sin(theta);\r\n    this.sun.z = Math.sin(phi) * Math.cos(theta);\r\n\r\n    uniforms['sunPosition'].value.copy(this.sun);\r\n    this.renderer.render(this.scene, this.camera);\r\n  }\r\n\r\n  // 允许外部通过此方法更新参数\r\n  setParameters(params) {\r\n    this.effectController = { ...this.effectController, ...params };\r\n    this.updateSky();\r\n  }\r\n\r\n  animate() {\r\n    requestAnimationFrame(this.animate.bind(this));\r\n    this.updateSky();\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}