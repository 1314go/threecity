{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { onMounted, ref, watch } from \"vue\";\nimport * as THREE from \"three\";\nimport gsap from \"gsap\";\n\n// 导入gui对象\nimport gui from \"@/three/gui\";\n// 导入场景\nimport scene from \"@/three/scene\";\n// 导入相机\nimport camera from \"@/three/camera\";\n// 导入控制器\nimport controls from \"@/three/controls\";\n// 导入辅助坐标轴\nimport axesHelper from \"@/three/axesHelper\";\n// 导入渲染器\nimport renderer from \"@/three/renderer\";\n// 初始化调整屏幕\nimport \"@/three/init\";\n// 导入添加物体函数\nimport createMesh from \"@/three/createMesh\";\n// 导入每一帧的执行函数\nimport animate from \"@/three/animate\";\nimport AlarmSprite from \"@/three/mesh/AlarmSprite\";\nimport LightWall from \"@/three/mesh/LightWall\";\nimport FlyLineShader from \"@/three/mesh/FlyLineShader\";\nimport LightRadar from \"@/three/mesh/LightRadar\";\nimport Sun from \"@/three/mesh/sun\";\nimport sky from \"@/three/mesh/sky\";\nimport eventHub from \"@/utils/eventHub\";\nexport default {\n  __name: 'Scene',\n  props: [\"eventList\"],\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const props = __props;\n    // 场景元素div\n    let sceneDiv = ref(null);\n    // 添加相机\n    scene.add(camera);\n    // 添加辅助坐标轴\n    scene.add(axesHelper);\n    const skyController = new sky(scene, camera, renderer);\n    scene.add(skyController.sky);\n    // 创建太阳实例并添加到场景中\n    // const sun = new Sun({ x: 0, y: 0, z: 0 });\n    // scene.add(sun.scene);\n\n    // scene.add(sun.scene);\n    // 创建物体\n\n    const clock = new THREE.Clock();\n    animate();\n    createMesh();\n    const eventListMesh = [];\n    let mapFn = {\n      火警: (position, i) => {\n        const lightWall = new LightWall(1, 2, position);\n        lightWall.eventListIndex = i;\n        scene.add(lightWall.mesh);\n        eventListMesh.push(lightWall);\n      },\n      治安: (position, i) => {\n        //   生成随机颜色\n        const color = new THREE.Color(Math.random(), Math.random(), Math.random()).getHex();\n        // 添加着色器飞线\n        const flyLineShader = new FlyLineShader(position, color);\n        flyLineShader.eventListIndex = i;\n        scene.add(flyLineShader.mesh);\n        eventListMesh.push(flyLineShader);\n      },\n      电力: (position, i) => {\n        // 添加雷达\n        const lightRadar = new LightRadar(2, position);\n        lightRadar.eventListIndex = i;\n        scene.add(lightRadar.mesh);\n        eventListMesh.push(lightRadar);\n      }\n    };\n    eventHub.on(\"toggleEvent\", i => {\n      eventListMesh.forEach(item => {\n        if (item.eventListIndex === i) {\n          item.mesh.visible = true;\n        } else {\n          item.mesh.visible = false;\n        }\n        camera.lookAt(item.mesh.position);\n      });\n    });\n    watch(() => props.eventList, val => {\n      //console.log(val);\n      eventListMesh.forEach(item => {\n        item.remove();\n      });\n      props.eventList.forEach((item, i) => {\n        const position = {\n          x: item.position.x / 5 - 10,\n          z: item.position.y / 5 - 10\n        };\n        const alarmSprite = new AlarmSprite(item.name, position);\n        alarmSprite.onClick(() => {\n          //console.log(item.name,i);\n          eventHub.emit(\"spriteClik\", {\n            event: item,\n            i\n          });\n        });\n        alarmSprite.eventListIndex = i;\n        eventListMesh.push(alarmSprite);\n        scene.add(alarmSprite.mesh);\n        console.log(item);\n        if (mapFn[item.name]) {\n          mapFn[item.name](position, i);\n        }\n      });\n    });\n    onMounted(() => {\n      sceneDiv.value.appendChild(renderer.domElement);\n      animate();\n    });\n    const __returned__ = {\n      props,\n      get sceneDiv() {\n        return sceneDiv;\n      },\n      set sceneDiv(v) {\n        sceneDiv = v;\n      },\n      skyController,\n      clock,\n      eventListMesh,\n      get mapFn() {\n        return mapFn;\n      },\n      set mapFn(v) {\n        mapFn = v;\n      },\n      onMounted,\n      ref,\n      watch,\n      get THREE() {\n        return THREE;\n      },\n      get gsap() {\n        return gsap;\n      },\n      get gui() {\n        return gui;\n      },\n      get scene() {\n        return scene;\n      },\n      get camera() {\n        return camera;\n      },\n      get controls() {\n        return controls;\n      },\n      get axesHelper() {\n        return axesHelper;\n      },\n      get renderer() {\n        return renderer;\n      },\n      get createMesh() {\n        return createMesh;\n      },\n      get animate() {\n        return animate;\n      },\n      get AlarmSprite() {\n        return AlarmSprite;\n      },\n      get LightWall() {\n        return LightWall;\n      },\n      get FlyLineShader() {\n        return FlyLineShader;\n      },\n      get LightRadar() {\n        return LightRadar;\n      },\n      get Sun() {\n        return Sun;\n      },\n      get sky() {\n        return sky;\n      },\n      get eventHub() {\n        return eventHub;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["onMounted","ref","watch","THREE","gsap","gui","scene","camera","controls","axesHelper","renderer","createMesh","animate","AlarmSprite","LightWall","FlyLineShader","LightRadar","Sun","sky","eventHub","props","__props","sceneDiv","add","skyController","clock","Clock","eventListMesh","mapFn","火警","position","i","lightWall","eventListIndex","mesh","push","治安","color","Color","Math","random","getHex","flyLineShader","电力","lightRadar","on","forEach","item","visible","lookAt","eventList","val","remove","x","z","y","alarmSprite","name","onClick","emit","event","console","log","value","appendChild","domElement"],"sources":["E:/three.js/three.js-demo/three-city/city/src/components/Scene.vue"],"sourcesContent":["<template>\r\n  <div class=\"scene\" ref=\"sceneDiv\"></div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, watch } from \"vue\";\r\nimport * as THREE from \"three\";\r\nimport gsap from \"gsap\";\r\n\r\n// 导入gui对象\r\nimport gui from \"@/three/gui\";\r\n// 导入场景\r\nimport scene from \"@/three/scene\";\r\n// 导入相机\r\nimport camera from \"@/three/camera\";\r\n// 导入控制器\r\nimport controls from \"@/three/controls\";\r\n// 导入辅助坐标轴\r\nimport axesHelper from \"@/three/axesHelper\";\r\n// 导入渲染器\r\nimport renderer from \"@/three/renderer\";\r\n// 初始化调整屏幕\r\nimport \"@/three/init\";\r\n// 导入添加物体函数\r\nimport createMesh from \"@/three/createMesh\";\r\n// 导入每一帧的执行函数\r\nimport animate from \"@/three/animate\";\r\nimport  AlarmSprite from \"@/three/mesh/AlarmSprite\";\r\nimport LightWall from \"@/three/mesh/LightWall\";\r\nimport FlyLineShader from \"@/three/mesh/FlyLineShader\";\r\nimport LightRadar from \"@/three/mesh/LightRadar\";\r\nimport Sun from \"@/three/mesh/sun\";\r\nimport sky from \"@/three/mesh/sky\";\r\nimport eventHub from \"@/utils/eventHub\";\r\nconst props = defineProps([\"eventList\"]);\r\n// 场景元素div\r\nlet sceneDiv = ref(null);\r\n// 添加相机\r\nscene.add(camera);\r\n// 添加辅助坐标轴\r\nscene.add(axesHelper);\r\n\r\nconst skyController = new sky(scene, camera, renderer);\r\nscene.add(skyController.sky);\r\n// 创建太阳实例并添加到场景中\r\n// const sun = new Sun({ x: 0, y: 0, z: 0 });\r\n// scene.add(sun.scene);\r\n\r\n// scene.add(sun.scene);\r\n// 创建物体\r\n\r\n\r\nconst clock = new THREE.Clock();\r\nanimate();\r\ncreateMesh();\r\nconst eventListMesh = [];\r\nlet mapFn = {\r\n  火警: (position, i) => {\r\n    const lightWall = new LightWall(1, 2, position);\r\n    lightWall.eventListIndex = i;\r\n    scene.add(lightWall.mesh);\r\n    eventListMesh.push(lightWall);\r\n  },\r\n  治安: (position, i) => {\r\n    //   生成随机颜色\r\n    const color = new THREE.Color(\r\n      Math.random(),\r\n      Math.random(),\r\n      Math.random()\r\n    ).getHex();\r\n    // 添加着色器飞线\r\n    const flyLineShader = new FlyLineShader(position, color);\r\n    flyLineShader.eventListIndex = i;\r\n    scene.add(flyLineShader.mesh);\r\n    eventListMesh.push(flyLineShader);\r\n  },\r\n  \r\n  电力: (position, i) => {\r\n    // 添加雷达\r\n    const lightRadar = new LightRadar(2, position);\r\n    lightRadar.eventListIndex = i;\r\n    scene.add(lightRadar.mesh);\r\n    eventListMesh.push(lightRadar);\r\n  },\r\n\r\n};\r\neventHub.on(\"toggleEvent\",(i)=>{\r\n  eventListMesh.forEach((item)=>{\r\n    if(item.eventListIndex===i){\r\n       item.mesh.visible=true; \r\n    }else{\r\n        item.mesh.visible=false;\r\n    }\r\n    camera.lookAt(item.mesh.position);\r\n  });\r\n});\r\nwatch(\r\n  ()=>props.eventList,\r\n  (val)=>{\r\n    //console.log(val);\r\n    eventListMesh.forEach((item) => {\r\n      item.remove();\r\n    });\r\n    props.eventList.forEach((item,i)=>{\r\n      const position ={\r\n        x:item.position.x/5-10,\r\n        z:item.position.y/5-10,\r\n      } ;\r\n      const alarmSprite = new AlarmSprite(item.name,position);\r\n      alarmSprite.onClick(()=>{\r\n        //console.log(item.name,i);\r\n        eventHub.emit(\"spriteClik\",{event:item,i});\r\n\r\n      });\r\n      alarmSprite.eventListIndex=i;\r\n      eventListMesh.push(alarmSprite);\r\n      scene.add(alarmSprite.mesh);\r\n      console.log(item);\r\n      if (mapFn[item.name]) {\r\n        mapFn[item.name](position, i);\r\n      }\r\n    });\r\n  }\r\n);\r\n\r\nonMounted(() => {\r\n  sceneDiv.value.appendChild(renderer.domElement);\r\n  animate();\r\n});\r\n\r\n\r\n\r\n\r\n\r\n</script>\r\n\r\n<style >\r\n.scene {\r\n  width: 100vw;\r\n  height: 100vh;\r\n  position: fixed;\r\n  z-index: 100;\r\n  left: 0;\r\n  top: 0;\r\n}\r\n\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}